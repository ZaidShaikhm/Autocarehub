{% extends 'autocareapp/userhomepage.html' %}
{% load static %}
{% block content %}

<div class="container py-5">
  <h2 class="mb-4 text-center fw-bold text-gradient">My Vehicles</h2>

  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show shadow-sm" role="alert">
        <div class="d-flex align-items-center">
          <i class="bi {% if message.tags == 'success' %}bi-check-circle-fill{% else %}bi-exclamation-triangle-fill{% endif %} me-2"></i>
          <div>{{ message }}</div>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  {% endif %}

  <div class="d-flex justify-content-end mb-4">
    <a href="{% url 'ad_vehicle' %}" class="btn btn-success btn-glow">
      <i class="bi bi-plus-circle me-2"></i> Add Vehicle
    </a>
  </div>

  {% if vehicles %}
  <div class="card shadow-sm border-0 overflow-hidden">
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead class="bg-light-primary">
          <tr>
            <th class="ps-4">Brand</th>
            <th>Model</th>
            <th>Year</th>
            <th>Vehicle Number</th>
            <th class="text-end pe-4">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for vehicle in vehicles %}
          <tr class="vehicle-row">
            <td class="ps-4 fw-medium">{{ vehicle.brand }}</td>
            <td>{{ vehicle.model }}</td>
            <td>{{ vehicle.year }}</td>
            <td>
              <span class="badge bg-light text-dark border">{{ vehicle.vehicle_number }}</span>
            </td>
            <td class="text-end pe-4">
              <div class="d-flex justify-content-end gap-2">
                <a href="{% url 'edit_vehicle' vehicle.id %}" class="btn btn-sm btn-soft-primary rounded-pill px-3 py-1">
                  <i class="bi bi-pencil-square me-1"></i> Edit
                </a>
                <form action="{% url 'delete_vehicle' vehicle.id %}" method="post" class="delete-form">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-sm btn-soft-danger rounded-pill px-3 py-1">
                    <i class="bi bi-trash me-1"></i> Delete
                  </button>
                </form>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  {% else %}
  <div class="card shadow-sm border-0 text-center py-5">
    <div class="card-body">
      <i class="bi bi-car-front text-muted" style="font-size: 3rem;"></i>
      <h5 class="mt-3 text-muted">No vehicles added yet</h5>
      <p class="text-muted mb-4">Add your first vehicle to get started</p>
      <a href="{% url 'ad_vehicle' %}" class="btn btn-primary">
        <i class="bi bi-plus-circle me-2"></i> Add Vehicle
      </a>
    </div>
  </div>
  {% endif %}

</div>

<style>
  /* Custom Styles */
  .text-gradient {
    background: linear-gradient(45deg, #0066cc, #00aaff);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  
  .bg-light-primary {
    background-color: rgba(0, 102, 204, 0.1);
  }
  
  .btn-glow {
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(0, 102, 204, 0.2);
  }
  
  .btn-glow:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 102, 204, 0.3);
  }
  
  .btn-soft-primary {
    background-color: rgba(0, 102, 204, 0.1);
    color: #0066cc;
    border: none;
  }
  
  .btn-soft-primary:hover {
    background-color: rgba(0, 102, 204, 0.2);
  }
  
  .btn-soft-danger {
    background-color: rgba(220, 53, 69, 0.1);
    color: #dc3545;
    border: none;
  }
  
  .btn-soft-danger:hover {
    background-color: rgba(220, 53, 69, 0.2);
  }
  
  .vehicle-row:hover {
    background-color: rgba(0, 102, 204, 0.05);
    cursor: pointer;
  }
  
  .form-control-lg {
    padding: 0.75rem 1rem;
    border-radius: 0.5rem;
    border: 1px solid #dee2e6;
  }
  
  .rounded-pill {
    border-radius: 50rem !important;
  }
</style>

<!-- SweetAlert2 CDN -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Confirm before deleting
    document.querySelectorAll('.delete-form').forEach(form => {
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        const currentForm = this;
        if (typeof Swal !== 'undefined') {
          Swal.fire({
            title: 'Are you sure?',
            text: "You won't be able to revert this!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#0066cc',
            cancelButtonColor: '#dc3545',
            confirmButtonText: 'Yes, delete it!'
          }).then((result) => {
            if (result.isConfirmed) {
              currentForm.submit();
            }
          });
        } else {
          // Fallback if SweetAlert2 is not loaded
          if (confirm('Are you sure you want to delete this vehicle?')) {
            currentForm.submit();
          }
        }
      });
    });

    // Add animation to table rows
    const rows = document.querySelectorAll('.vehicle-row');
    rows.forEach((row, index) => {
      row.style.opacity = '0';
      row.style.transform = 'translateY(20px)';
      row.style.transition = `all 0.3s ease ${index * 0.1}s`;
      
      setTimeout(() => {
        row.style.opacity = '1';
        row.style.transform = 'translateY(0)';
      }, 100);
    });
  });
</script>

{% endblock %}
